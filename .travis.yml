language: go
go:
- 1.8.x
cache:
  directories:
  - "$HOME/.local"
services:
- docker
before_install:
- sudo apt-get update
- sudo apt-get -y -o Dpkg::Options::="--force-confnew" install docker-ce
- docker --version
- chmod +x ./test.sh
- pip install --user --upgrade awscli
- export PATH=$PATH:$HOME/.local/bin
install:
- go get
before_script:
- aws s3 cp s3://ptt-alertor-bucket/config/ config/ --recursive
- ls -al config/
script:
- "./test.sh"
after_success:
- bash <(curl -s https://codecov.io/bash)
before_deploy:
- docker build -t meifamily/ptt-alertor .
- eval $(aws ecr get-login --region us-west-2 --no-include-email)
- docker tag meifamily/ptt-alertor:latest $AWS_Docker_Repo:latest
- docker push $AWS_Docker_Repo:latest
deploy:
- provider: script
  script:
  - bash ./deploy/ecs-deploy -r us-west-2 -c Production-Cluster -n Ptt-Aletor -i
    $AWS_Docker_Repo -m 0 -M 100 -t 600 -D 1
  on:
    branch: master
notifications:
  slack: meifamily:9oYnHKf0nlRn8QafX4PRZ1lC
env:
  global:
  - AWS_ACCESS_KEY_ID=AKIAJETASPZ4NVARC3IA
  - AWS_Docker_Repo=833648024955.dkr.ecr.us-west-2.amazonaws.com/ptt-alertor-repo
  - secure: nL7+ZzVPWihES7ryK/gLkPfcr9WewjCGSYrDFbczV22bIxUk+3cSL/F4I3r80rBoN5gDboHPP6MmM4N3tPrvObxh8CbVDE6mgcTlrCESrQwORjO4NpwrwWiE60sDNlse5pCR/6eLRINdV4GoWEMaNLwBxJUBovYnnRWsSWOcxuGEE/C2WThzjdIOXGDbQ6NhEperEIW1DhkVMHxDlcMiiOeixAyUGDM4o/3vXxWYHkv+t3OZSuwsGyC624xotXCJlYZc2y2DDpXDj2L9I0ybHdmUBXmfn/6d/ExB0yHQhs/jMWRiSuinIsb3r79u4aiiUm8Oq1ETKLClcHcmueqxY6tb41LJmzWfy55GEEYWe7ziCA8CSTNWjOokOhor79P2tzXlkGLJWW+87ErglXJQbEHU+lGhtnIGYmQvXcQnRIPMyeIT62ADx9XCQxnUwhavuXstDy7AYQ/zq9h5yXZXnUgSricTnlpSeyi5T1RdML7ne5Fs1kV6KtcVbmxhcwbndiR5ZwjvAvC5fMkUj4iB4W8U+RnmVAuJp1/x/f7DqGL9ONtX2zs00Zc2s6qAtgyLwV4nQC62WaqikvKSQAq3EYwtwqsZvC91veavD8+qEF/dw3rTDpPHKWdg153qydPjnSsWC74gclcHxXnW41mt0EYQcMh3Y+b/iEiUq4myrbg=
